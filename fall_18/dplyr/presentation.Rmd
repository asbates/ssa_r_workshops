---
title: "SSA R Coding Workshop 2"
subtitle: "Data Cleaning & Manipulation With Dplyr"
author: "Andrew Bates"
output: ioslides_presentation
---

## This Workshop

> - `dplyr` is part of the [tidyverse](https://www.tidyverse.org):
>     - "The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures."
> - "[dplyr](https://dplyr.tidyverse.org) is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges"
> - You **will** need to do data manipulation and cleaning
> - `dplyr` makes this easy and fun

## The Data 

> - Reviews of burritos in San Diego
> - Project of [Scott Cole](https://srcole.github.io/100burritos/), a neuroscience student at UCSD
> - Find it
>     - on his [website](https://github.com/asbates/ssa_r_workshops/tree/master/fall_18/data)
>     - or [Kaggle](https://www.kaggle.com/srcole/burritos-in-san-diego/version/2#burritos_01022018.csv)


## Setup

1. Go to https://github.com/asbates/ssa_r_workshops
2. Click the green "Clone or download" button
3. Select "Download ZIP" (unless you're familiar with Git)
4. Unzip and click on `ssa_r_workshops.Rproj` 
5. Install (if needed) and load the packages we will use
6. Read in the data

```{r setup_shown, eval = FALSE}
install.packages("dplyr", "readr", "here") 
library(dplyr)
library(readr)
library(here)
dirty_burrito <- read_csv(here("fall_18", "data", "burritos_01022018.csv"))
# or, if you don't want to use the here package
#dirty_burrito <- read_csv("path/to/file/burritos_01022018.csv")
```
     
```{r setup_hidden, echo = FALSE, message = FALSE, warning = FALSE}
library(dplyr)
library(readr)
library(here)
dirty_burrito <- read_csv(here("fall_18", "data", "burritos_01022018.csv"))

```


## First Look

```{r first_look_print}
dirty_burrito
```

## First Look
```{r first_look_names}
names(dirty_burrito)
```


## Some Issues

> - There are problems with some names:
>     - `readr` already took care of one issue (2 `Salsa` columns)
>     - Spaces in names are not very R friendly (`Mass (g)`)
>     - `Bell peper` is spelled wrong
>     - Inconsistent naming scheme (capitalization)
> - There are some `NA` values (not necessarily a problem)
> - `Chips` encoding is not so obvious (does `x` mean yes?)
> - What's the difference between `Tortilla` and `Wrap`?
> - The last two can probably be figured out with a data dictionary

## Fixing The Issues

> - To simplify things, let's start by:
>     - `select`ing just a few variables to work with
>     - and `rename`ing them

## Selecting Variables of Interest

```{r select_vars}
clean_burrito <- dirty_burrito %>%
  select(Location,
         Burrito,
         Yelp,
         Google,
         Cost,
         `Mass (g)`,
         Tortilla,
         Meat,
         Synergy,
         overall,
         Beans)
```


Note the use of backticks ` `` ` to handle the space in Mass


## Selecting Variables of Interest
```{r clean_first_pass}
clean_burrito
```


## Rename Variables

```{r rename}
clean_burrito <- clean_burrito %>%
  rename(
    location = Location,
    burrito = Burrito,
    yelp_rating = Yelp,
    google_rating = Google,
    cost = Cost,
    mass = `Mass (g)`,
    tortilla = Tortilla,
    meat = Meat,
    synergy = Synergy,
    overall_rating = overall,
    beans = Beans
  )
```

We rename using `new_name = old_name`


## Rename Variables

```{r}
clean_burrito
```

## Quiz 1

> - What does `select` do?
>     - `select`s variables (columns)
> - What does `rename` do?
>     - This should be obvious
> - What does `%>%` do?
>     - The 'pipe' operator
>     - From the package `magrittr`. Comes with `dplyr`
>     - Improves readability of code
>         - `x %>% h %>% g %>% f` instead of `f(g(h(x)))`
>         - "Take x. Apply the function h. Then g. Then f."
>     - First argument is always the data
>     - Allows for easy chaining of operations on data frame


## Recode Beans

 - Let's recode `beans`
 - We'll assume that an `x` means the burrito has beans
 - But first, let's see if `beans` takes any other values

```{r beans-levels}
clean_burrito %>%
  pull(beans) %>%
  as.factor() %>%
  levels
```

- OK. So `beans` can be either big or little x.



## Recode Beans

- Let's set `beans` to "yes" if it's either "x" or "X" and "no" otherwise
- We do this by `mutate`ing the original variable

```{r beans-yesno}
clean_burrito <- clean_burrito %>%
  mutate(
    beans = if_else(beans == "x" | beans == "X", "yes", "no")
  )
```




## Recode Beans

- Let's check to make sure we got what we wanted

```{r beans-yesno-check}
clean_burrito %>%
  select(beans)
```

## Recode Beans

- Whoops! It looks like we didn't replace the `NA` values.
- Let's try again

```{r beans-yesno-take2}
clean_burrito <- clean_burrito %>%
  mutate(
    beans = if_else(is.na(beans), "no", beans)
  )
```


## Recode Beans

- And check our work

```{r beans-yesno-check2}
clean_burrito %>%
  select(beans)
```


## Quiz 2

> - What's the difference between `select` and `pull`?
>     - `pull` gives us the *vector* `beans`
>     - `select` gives us a *data frame* with the column `beans`
> - What does `if_else()` do?
>     - If the first argument is true (`beans` is "x" or `beans` is "X)
>     - Do the second argument (set to "yes")
>     - Otherwise, do the third argument (set to "no")


## Summarize Overall Rating

- Great success!
- Let's take a closer look by `summarise`ing the data.
- We'll start with `overall_rating`

```{r overll-summ}
clean_burrito %>%
  summarise(
    min = min(overall_rating),
    mean = mean(overall_rating),
    median = median(overall_rating),
    max = max(overall_rating)
  )
```


## Summarize Overall Rating

- Uh oh! It looks like some burritos don't have ratings

```{r overall-summ2}
clean_burrito %>%
  summarise(
    min = min(overall_rating, na.rm = TRUE),
    mean = mean(overall_rating, na.rm = TRUE),
    median = median(overall_rating, na.rm = TRUE),
    max = max(overall_rating, na.rm = TRUE)
  )
```

## Summarize Rating By Burrito Type


```{r overall-group-by-typ}
clean_burrito %>%
  group_by(burrito) %>%
  summarise(
    mean_rating = mean(overall_rating, na.rm = TRUE)
  ) %>% 
  top_n(5)
```



## Summarize Rating By Location


```{r overall-group-by-loc}
clean_burrito %>%
  group_by(location) %>%
  summarise(
    mean_rating = mean(overall_rating, na.rm = TRUE)
  ) %>% 
  top_n(5)
```


## Average Rating for Burritos with Beans

```{r overall-beans}
clean_burrito %>%
  filter(beans == "yes") %>%
  group_by(location) %>%
  summarise(
    mean_rating = mean(overall_rating, na.rm = TRUE)
  ) %>% 
  top_n(-3)
```


## Quiz 3

> - What did we learn?
>     - California-like burritos are the way to go
>     - Get one at Chili Peppers
>     - Don't go to Goody's if you like beans







